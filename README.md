æ¸…å¤§é¸èª²å°å¹«æ‰‹ - å°ˆæ¡ˆè—åœ–ç¸½è¦½
é€™ä»½æ–‡ä»¶åŒ…å«äº†ã€Œæ¸…å¤§é¸èª²å°å¹«æ‰‹ã€Chrome æ“´å……åŠŸèƒ½çš„æ‰€æœ‰è¦åŠƒã€æª”æ¡ˆçµæ§‹èˆ‡ç¨‹å¼ç¢¼æ¡†æ¶ã€‚

README.md
é€™æ˜¯ä¸€å€‹æ—¨åœ¨æ”¹å–„åœ‹ç«‹æ¸…è¯å¤§å­¸ç¶²è·¯é¸èª²ç³»çµ±ä½¿ç”¨è€…é«”é©—çš„ Chrome æ“´å……åŠŸèƒ½ã€‚

åŠŸèƒ½ç‰¹è‰²
é€²éšç¯©é¸å™¨ï¼š

åœ¨ã€Œç¸½éŒ„ã€èª²ç¨‹é é¢ (JH713004.php) ä¸Šæ–¹æ–°å¢ç¯©é¸é¢æ¿ã€‚

æ”¯æ´ä¾ èª²ç¨‹åç¨± æˆ– æ•™å¸«å§“å é—œéµå­—å³æ™‚ç¯©é¸ã€‚

æä¾› 7x14 çš„è¦–è¦ºåŒ–æ™‚é–“ç¯©é¸å™¨ï¼Œä½¿ç”¨è€…å¯é»æ“Šæ ¼å­è‡ªè¨‚ç¯©é¸ç„¡è¡å ‚çš„ç©ºé–’æ™‚æ®µã€‚

æ™ºæ…§è¡å ‚ç®¡ç†ï¼š

è‡ªå‹•è®€å–ã€Œé¸èª²çµæœé ã€(JH713005.php) ä¸Šçš„å·²é¸èª²ç¨‹æ™‚é–“ã€‚

æä¾› ã€Œéš±è—è¡å ‚èª²ç¨‹ã€ åŠŸèƒ½ï¼Œä¸€éµéæ¿¾æ‰èˆ‡ç¾æœ‰èª²è¡¨è¡çªçš„èª²ç¨‹ã€‚

åŒ…å« ã€Œå…è¨±é€šè­˜èª²ç¨‹è¡å ‚ã€ çš„é¸é …ï¼Œåœ¨ç¯©é¸æ™‚ä¿ç•™é€šè­˜èª²çš„å¿—é¡˜å½ˆæ€§ã€‚

èª²ç¨‹è©•åƒ¹å¿«æœï¼š

åœ¨æ¯é–€èª²ç¨‹çš„ã€Œç§‘ç›®åç¨±ã€å’Œã€Œæ•™å¸«ã€æ—æ–°å¢æŸ¥è©¢æŒ‰éˆ•ã€‚

é»æ“ŠæŒ‰éˆ•å¾Œå¯é¸æ“‡åœ¨ Dcard æˆ– æ­è¶´ç³– ä¸Šæœå°‹è©•åƒ¹ã€‚

æä¾›ä¸‰ç¨®æœå°‹æ¨¡å¼ï¼šã€Œåƒ…èª²åã€ã€ã€Œåƒ…æ•™å¸«åã€ã€ã€Œèª²å+æ•™å¸«åã€ã€‚

æœå°‹çµæœå°‡åœ¨ä¸é›¢é–‹é¸èª²é é¢çš„ äº’å‹•è¦–çª—(Modal) ä¸­é¡¯ç¤ºã€‚

è¼”åŠ©å·¥å…·ï¼š

å³æ™‚å­¸åˆ†è¨ˆæ•¸å™¨ï¼šé¡¯ç¤ºç•¶å‰ç¯©é¸çµæœçš„ç¸½å­¸åˆ†æ•¸ï¼Œä¸¦å¯å‹¾é¸èª²ç¨‹ä¾†ç´¯åŠ é è¨ˆä¿®èª²å­¸åˆ†ã€‚

æˆ‘çš„æœ€æ„›ï¼šå¯å°‡æ„Ÿèˆˆè¶£çš„èª²ç¨‹åŠ å…¥æ”¶è—ï¼Œæ–¹ä¾¿è·¨ç³»æ‰€æ¯”è¼ƒã€‚

å€‹äººåŒ–è¨­å®šï¼š

é€éæ“´å……åŠŸèƒ½çš„ Popup é é¢é€²è¡Œè¨­å®šï¼Œä¾‹å¦‚æ°¸ä¹…ä¿å­˜ã€Œå…è¨±é€šè­˜è¡å ‚ã€çš„é¸é …ã€‚

Popup é é¢ä¹ŸåŒ…å«é–‹ç™¼è€…æ”¯æŒé€£çµå’Œæœªä¾†åŠŸèƒ½æ“´å……çš„ç©ºé–“ã€‚

å°ˆæ¡ˆçµæ§‹
æœ¬å°ˆæ¡ˆæ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œä»¥ç¢ºä¿ç¨‹å¼ç¢¼çš„æ¸…æ™°åº¦èˆ‡å¯ç¶­è­·æ€§ã€‚

manifest.jsonï¼šæ“´å……åŠŸèƒ½çš„è¨­å®šæª”ï¼Œå®šç¾©æ¬Šé™èˆ‡åŸ·è¡Œçš„è…³æœ¬ã€‚

/popupï¼šå­˜æ”¾æ“´å……åŠŸèƒ½å½ˆå‡ºè¦–çª—çš„ç›¸é—œæª”æ¡ˆã€‚

popup.html: å½ˆå‡ºè¦–çª—çš„ä»‹é¢ã€‚

popup.js: å½ˆå‡ºè¦–çª—çš„é‚è¼¯ã€‚

popup.css: å½ˆå‡ºè¦–çª—çš„æ¨£å¼ã€‚

/scriptsï¼šæ³¨å…¥åˆ°é¸èª²é é¢çš„æ ¸å¿ƒè…³æœ¬ã€‚

content.js: å…§å®¹è…³æœ¬é€²å…¥é»ï¼Œè² è²¬å”èª¿å…¶ä»–æ¨¡çµ„ã€‚

ui.js: è² è²¬å»ºç«‹ä¸¦æ³¨å…¥ç¯©é¸å™¨ã€æŒ‰éˆ•ç­‰ UI å…ƒç´ ã€‚

filter.js: è™•ç†æ‰€æœ‰èª²ç¨‹ç¯©é¸çš„æ ¸å¿ƒé‚è¼¯ã€‚

parser.js: è² è²¬å¾ HTML ä¸­è§£æèª²ç¨‹è³‡æ–™èˆ‡ä½¿ç”¨è€…èª²è¡¨ã€‚

modal.js: è² è²¬å»ºç«‹èˆ‡ç®¡ç†è©•åƒ¹æŸ¥è©¢çš„äº’å‹•è¦–çª—ã€‚

/stylesï¼šæ³¨å…¥åˆ°é¸èª²é é¢çš„æ¨£å¼æª”æ¡ˆã€‚

style.css: ç¯©é¸å™¨ã€äº’å‹•è¦–çª—ç­‰è‡ªè¨‚ UI çš„æ¨£å¼ã€‚

/iconsï¼šå­˜æ”¾æ“´å……åŠŸèƒ½çš„åœ–ç¤ºã€‚

manifest.json
JSON

{
  "manifest_version": 3,
  "name": "æ¸…å¤§é¸èª²å°å¹«æ‰‹",
  "version": "1.0",
  "description": "æ”¹å–„æ¸…è¯å¤§å­¸ç¶²è·¯é¸èª²ç³»çµ±çš„é«”é©—ï¼Œæä¾›é€²éšç¯©é¸èˆ‡è©•åƒ¹æŸ¥è©¢åŠŸèƒ½ã€‚",
  "permissions": [
    "storage"
  ],
  "host_permissions": [
    "https://www.ccxp.nthu.edu.tw/ccxp/COURSE/JH/7/7.1/7.1.3/*"
  ],
  "icons": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png",
    "128": "icons/icon128.png"
  },
  "action": {
    "default_popup": "popup/popup.html",
    "default_icon": {
      "16": "icons/icon16.png",
      "48": "icons/icon48.png"
    }
  },
  "content_scripts": [
    {
      "matches": [
        "https://www.ccxp.nthu.edu.tw/ccxp/COURSE/JH/7/7.1/7.1.3/JH713004.php*"
      ],
      "js": [
        "scripts/modal.js",
        "scripts/parser.js",
        "scripts/filter.js",
        "scripts/ui.js",
        "scripts/content.js"
      ],
      "css": [
        "styles/style.css"
      ]
    }
  ]
}
popup/popup.html
HTML

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ¸…å¤§é¸èª²å°å¹«æ‰‹è¨­å®š</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>æ¸…å¤§é¸èª²å°å¹«æ‰‹</h1>
      <p class="version">ç‰ˆæœ¬ 1.0</p>
    </header>
    
    <main class="settings">
      <h2>åŠŸèƒ½è¨­å®š</h2>
      <div class="setting-item">
        <label for="allow-ge-clash">å…è¨±é€šè­˜èª²ç¨‹è¡å ‚</label>
        <input type="checkbox" id="allow-ge-clash" />
      </div>
      </main>

    <hr>

    <section class="support">
      <h2>æ”¯æŒé–‹ç™¼è€…</h2>
      <p>å¦‚æœé€™å€‹å·¥å…·å°ä½ æœ‰å¹«åŠ©ï¼Œå¯ä»¥è€ƒæ…®<a href="YOUR_SUPPORT_LINK_HERE" target="_blank">è«‹æˆ‘å–æ¯å’–å•¡</a>ï¼</p>
    </section>
  </div>
  <script src="popup.js"></script>
</body>
</html>
popup/popup.js
JavaScript

// popup/popup.js

document.addEventListener('DOMContentLoaded', () => {
  const allowGeClashCheckbox = document.getElementById('allow-ge-clash');

  // è¼‰å…¥å„²å­˜çš„è¨­å®š
  chrome.storage.sync.get(['allowGeClash'], (result) => {
    allowGeClashCheckbox.checked = !!result.allowGeClash;
  });

  // ç›£è½è¨­å®šè®Šæ›´ä¸¦å„²å­˜
  allowGeClashCheckbox.addEventListener('change', () => {
    chrome.storage.sync.set({ allowGeClash: allowGeClashCheckbox.checked });
  });
});
popup/popup.css
CSS

/* popup/popup.css */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  width: 280px;
  background-color: #f9f9f9;
  color: #333;
}

.container {
  padding: 15px;
}

header {
  text-align: center;
  border-bottom: 1px solid #ddd;
  padding-bottom: 10px;
  margin-bottom: 15px;
}

h1 {
  font-size: 1.2em;
  margin: 0;
  color: #2c3e50;
}

.version {
  font-size: 0.8em;
  color: #7f8c8d;
}

.settings h2, .support h2 {
  font-size: 1em;
  color: #34495e;
  margin-top: 0;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.support p {
  font-size: 0.9em;
}

a {
  color: #3498db;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
scripts/content.js
JavaScript

// scripts/content.js
// é€™æ˜¯æ“´å……åŠŸèƒ½çš„é€²å…¥é» (Entry Point)

console.log("æ¸…å¤§é¸èª²å°å¹«æ‰‹å·²å•Ÿå‹•ï¼");

// é é¢è¼‰å…¥å¾ŒåŸ·è¡Œçš„ä¸»å‡½å¼
function main() {
    // 1. æ³¨å…¥ UI ä»‹é¢
    const courseTable = document.getElementById('T1');
    if (!courseTable) {
        console.error("æ‰¾ä¸åˆ°èª²ç¨‹è¡¨æ ¼ #T1");
        return;
    }
    const filterUI = NthuCourseHelperUI.createFilterUI();
    // å°‡ç¯©é¸å™¨UIæ’å…¥åˆ°è¡¨æ ¼ä¹‹å‰
    courseTable.parentNode.insertBefore(filterUI, courseTable);
    
    // 2. è§£æèª²ç¨‹è³‡æ–™ä¸¦æ³¨å…¥æŸ¥è©¢æŒ‰éˆ•
    const courses = NthuCourseParser.parseCourseTable(courseTable);
    NthuCourseHelperUI.injectSearchButtons(courseTable, courses);

    // 3. ç¶å®šäº‹ä»¶ç›£è½å™¨
    setupEventListeners(courses, courseTable);
}

// è¨­å®šæ‰€æœ‰äº‹ä»¶ç›£è½
function setupEventListeners(courses, table) {
    const nameFilter = document.getElementById('nthu-helper-filter-name');
    const teacherFilter = document.getElementById('nthu-helper-filter-teacher');
    const timeGrid = document.querySelector('.nthu-helper-time-grid');
    const hideClashCheckbox = document.getElementById('nthu-helper-hide-clash');
    
    // èª²åå’Œæ•™å¸«åç¨±ç¯©é¸
    nameFilter.addEventListener('input', () => NthuCourseFilter.filterAll(table, courses));
    teacherFilter.addEventListener('input', () => NthuCourseFilter.filterAll(table, courses));

    // æ™‚é–“æ ¼å­é»æ“Šç¯©é¸
    timeGrid.addEventListener('click', (event) => {
        if (event.target.classList.contains('time-slot')) {
            event.target.classList.toggle('selected');
            NthuCourseFilter.filterAll(table, courses);
        }
    });
    
    // éš±è—è¡å ‚èª²ç¨‹
    hideClashCheckbox.addEventListener('change', () => NthuCourseFilter.filterAll(table, courses));
    
    // ç›£è½æŸ¥è©¢æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ (ä½¿ç”¨äº‹ä»¶å§”æ´¾)
    table.addEventListener('click', (event) => {
        const target = event.target.closest('.nthu-helper-search-btn');
        if (!target) return;

        const courseIndex = parseInt(target.dataset.index, 10);
        const course = courses[courseIndex];
        
        NthuCourseHelperUI.showSearchMenu(event.clientX, event.clientY, course);
    });
}

// åŸ·è¡Œä¸»å‡½å¼
main();
scripts/ui.js
JavaScript

// scripts/ui.js
// è² è²¬å»ºç«‹ä¸¦æ³¨å…¥æ‰€æœ‰ UI å…ƒç´ 

const NthuCourseHelperUI = {
    // å»ºç«‹ç¯©é¸å™¨é¢æ¿
    createFilterUI() {
        const container = document.createElement('div');
        container.className = 'nthu-helper-container';
        container.innerHTML = `
            <h2>æ¸…å¤§é¸èª²å°å¹«æ‰‹ç¯©é¸å™¨</h2>
            <div class="filters">
                <input type="text" id="nthu-helper-filter-name" placeholder="ç¯©é¸èª²ç¨‹åç¨±...">
                <input type="text" id="nthu-helper-filter-teacher" placeholder="ç¯©é¸æ•™å¸«å§“å...">
                <div class="filter-options">
                  <label><input type="checkbox" id="nthu-helper-hide-clash"> éš±è—è¡å ‚èª²ç¨‹</label>
                </div>
            </div>
            <h3>è‡ªè¨‚æ™‚é–“ç¯©é¸</h3>
            <div class="nthu-helper-time-grid">${this.createTimeGrid()}</div>
        `;
        return container;
    },

    // å»ºç«‹ 7x14 çš„æ™‚é–“é¸æ“‡æ ¼å­
    createTimeGrid() {
        let gridHTML = '<div class="time-header"><div></div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div><div>æ—¥</div></div>';
        const slots = ['1', '2', '3', '4', 'n', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd'];
        slots.forEach(slot => {
            gridHTML += `<div class="time-row"><div class="time-label">${slot}</div>`;
            for (let day = 1; day <= 7; day++) {
                gridHTML += `<div class="time-slot" data-day="${day}" data-slot="${slot}"></div>`;
            }
            gridHTML += '</div>';
        });
        return gridHTML;
    },
    
    // æ³¨å…¥æŸ¥è©¢æŒ‰éˆ•åˆ°èª²ç¨‹è¡¨æ ¼
    injectSearchButtons(table, courses) {
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach((row, index) => {
            if (!courses[index]) return; // å¦‚æœè©²è¡Œæ²’æœ‰è§£æå‡ºèª²ç¨‹è³‡æ–™ï¼Œå‰‡è·³é

            // åœ¨ç§‘ç›®åç¨±æ¬„ä½æ–°å¢æŒ‰éˆ•
            const nameCell = row.cells[2];
            if (nameCell) {
                nameCell.style.position = 'relative';
                const searchBtn = this.createSearchButton(index);
                nameCell.appendChild(searchBtn);
            }
            
            // åœ¨æ•™å¸«æ¬„ä½æ–°å¢æŒ‰éˆ•
            const teacherCell = row.cells[6];
            if (teacherCell) {
                teacherCell.style.position = 'relative';
                const searchBtn = this.createSearchButton(index);
                teacherCell.appendChild(searchBtn);
            }
        });
    },
    
    // å»ºç«‹å–®ä¸€æŸ¥è©¢æŒ‰éˆ•
    createSearchButton(index) {
        const button = document.createElement('button');
        button.className = 'nthu-helper-search-btn';
        button.innerHTML = 'ğŸ”';
        button.title = 'æŸ¥è©¢èª²ç¨‹è©•åƒ¹';
        button.dataset.index = index;
        return button;
    },
    
    // é¡¯ç¤ºæŸ¥è©¢é¸é …èœå–®
    showSearchMenu(x, y, course) {
        // ç§»é™¤å·²å­˜åœ¨çš„èœå–®
        const existingMenu = document.getElementById('nthu-helper-search-menu');
        if (existingMenu) existingMenu.remove();

        const menu = document.createElement('div');
        menu.id = 'nthu-helper-search-menu';
        
        const teacherName = course.teacher.split('<br>')[0]; // åªå–ç¬¬ä¸€ä½è€å¸«çš„åå­—

        menu.innerHTML = `
            <div class="menu-title">é¸æ“‡æœå°‹æ–¹å¼</div>
            <ul>
                <li data-type="dcard" data-query="${course.name}">Dcard: èª²ç¨‹å</li>
                <li data-type="opass" data-query="${course.name}">æ­è¶´ç³–: èª²ç¨‹å</li>
                <li data-type="dcard" data-query="${teacherName}">Dcard: æ•™å¸«å</li>
                <li data-type="opass" data-query="${teacherName}">æ­è¶´ç³–: æ•™å¸«å</li>
                <li data-type="dcard" data-query="${course.name} ${teacherName}">Dcard: èª²å+æ•™å¸«å</li>
                <li data-type="opass" data-query="${course.name} ${teacherName}">æ­è¶´ç³–: èª²å+æ•™å¸«å</li>
            </ul>
        `;
        
        menu.style.left = `${x}px`;
        menu.style.top = `${y}px`;
        document.body.appendChild(menu);

        // èœå–®é»æ“Šäº‹ä»¶
        menu.addEventListener('click', (event) => {
            if (event.target.tagName === 'LI') {
                const type = event.target.dataset.type;
                const query = event.target.dataset.query;
                let url = '';
                if (type === 'dcard') {
                    url = `https://www.dcard.tw/search/posts?query=${encodeURIComponent('æ¸…å¤§ ' + query)}`;
                } else {
                    url = `https://www.opass.app/search?q=${encodeURIComponent(query)}`;
                }
                NthuCourseModal.show(url);
                menu.remove();
            }
        });

        // é»æ“Šèœå–®å¤–éƒ¨å³å¯é—œé–‰
        setTimeout(() => {
            document.addEventListener('click', () => menu.remove(), { once: true });
        }, 0);
    }
};
scripts/filter.js
JavaScript

// scripts/filter.js
// è™•ç†æ‰€æœ‰ç¯©é¸é‚è¼¯

const NthuCourseFilter = {
    
    // ä¸»ç¯©é¸å‡½æ•¸ï¼Œæ•´åˆæ‰€æœ‰ç¯©é¸æ¢ä»¶
    filterAll(table, courses) {
        const nameQuery = document.getElementById('nthu-helper-filter-name').value.toLowerCase();
        const teacherQuery = document.getElementById('nthu-helper-filter-teacher').value.toLowerCase();
        const selectedTimes = this.getSelectedTimes();
        const hideClash = document.getElementById('nthu-helper-hide-clash').checked;

        // å¾ storage ç²å–é€šè­˜è¡å ‚è¨­å®š
        chrome.storage.sync.get(['allowGeClash'], result => {
            const allowGeClash = !!result.allowGeClash;
            
            // TODO: éœ€è¦ä¸€å€‹å‡½æ•¸ä¾†ç•°æ­¥ç²å–å·²é¸èª²ç¨‹æ™‚é–“
            const existingSchedule = []; // æš«æ™‚ç‚ºç©ºï¼Œéœ€å¾ JH713005.html è§£æ

            const rows = table.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                const course = courses[index];
                if (!course) return;

                const nameMatch = course.name.toLowerCase().includes(nameQuery);
                const teacherMatch = course.teacher.toLowerCase().includes(teacherQuery);
                const timeMatch = this.checkTimeMatch(course.time, selectedTimes);
                const clashMatch = hideClash ? !this.isClashing(course, existingSchedule, allowGeClash) : true;

                if (nameMatch && teacherMatch && timeMatch && clashMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    },

    // ç²å–ä½¿ç”¨è€…åœ¨æ™‚é–“æ ¼å­ä¸Šé¸æ“‡çš„æ™‚é–“
    getSelectedTimes() {
        const selectedSlots = document.querySelectorAll('.nthu-helper-time-grid .time-slot.selected');
        if (selectedSlots.length === 0) return null; // å¦‚æœæ²’æœ‰é¸æ“‡ï¼Œå‰‡ä¸é€²è¡Œæ™‚é–“ç¯©é¸
        
        const times = [];
        selectedSlots.forEach(slot => {
            times.push({ day: slot.dataset.day, slot: slot.dataset.slot });
        });
        return times;
    },

    // æª¢æŸ¥èª²ç¨‹æ™‚é–“æ˜¯å¦ç¬¦åˆç¯©é¸
    checkTimeMatch(courseTime, selectedTimes) {
        if (!selectedTimes) return true; // æ²’æœ‰é¸æ“‡æ™‚é–“ï¼Œå‰‡æ‰€æœ‰èª²ç¨‹éƒ½ç¬¦åˆ
        if (!courseTime) return false; // èª²ç¨‹æ²’æœ‰æ™‚é–“ï¼Œå‰‡ä¸ç¬¦åˆ
        
        // TODO: éœ€è¦ä¸€å€‹è§£æ courseTime (å¦‚ "M7M8R6") çš„è¼”åŠ©å‡½æ•¸
        const courseSlots = NthuCourseParser.parseTimeCode(courseTime); // å‡è¨­æœ‰é€™å€‹è§£æå‡½æ•¸
        
        // åªè¦èª²ç¨‹æ™‚é–“ä¸­æœ‰ä¸€å€‹æ™‚æ®µç¬¦åˆä½¿ç”¨è€…é¸æ“‡çš„ä»»ä¸€æ™‚æ®µå³å¯
        for (const selected of selectedTimes) {
            for (const course of courseSlots) {
                if (selected.day == course.day && selected.slot == course.slot) {
                    return true;
                }
            }
        }
        return false;
    },

    // æª¢æŸ¥èª²ç¨‹æ˜¯å¦èˆ‡ç¾æœ‰èª²è¡¨è¡å ‚
    isClashing(course, schedule, allowGeClash) {
        if (allowGeClash && course.id.includes('GE')) {
            return false; // å¦‚æœå…è¨±é€šè­˜è¡å ‚ä¸”æ­¤èª²ç‚ºé€šè­˜ï¼Œå‰‡ä¸ç®—è¡å ‚
        }
        
        const courseSlots = NthuCourseParser.parseTimeCode(course.time);
        
        for (const existing of schedule) {
            for (const courseSlot of courseSlots) {
                // TODO: éœ€è¦æ›´è©³ç´°çš„è¡å ‚æ¯”å°é‚è¼¯
                if (existing.day == courseSlot.day && existing.slot == courseSlot.slot) {
                    return true; // ç™¼ç¾è¡å ‚
                }
            }
        }
        return false;
    }
};
scripts/parser.js
JavaScript

// scripts/parser.js
// è² è²¬å¾ HTML é é¢è§£æè³‡æ–™

const NthuCourseParser = {
    // è§£æèª²ç¨‹ç¸½è¡¨
    parseCourseTable(table) {
        const courses = [];
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach(row => {
            if (row.cells.length < 13) return; // ç¢ºä¿æ˜¯æœ‰æ•ˆçš„èª²ç¨‹è¡Œ

            const course = {
                id: row.cells[1].innerText.trim(),
                name: row.cells[2].innerText.split('\n')[0].trim(),
                nameEn: row.cells[2].innerText.split('\n')[1]?.trim() || '',
                credit: row.cells[3].innerText.trim(),
                time: row.cells[4].innerText.trim(),
                room: row.cells[5].innerText.trim(),
                teacher: row.cells[6].innerText.trim(),
                // ... å¯ä»¥ç¹¼çºŒè§£ææ›´å¤šæ¬„ä½
            };
            courses.push(course);
        });
        return courses;
    },

    // TODO: è§£ææ™‚é–“ä»£ç¢¼ (e.g., "M7M8R6")
    parseTimeCode(timeCode) {
        // é€™æ˜¯ä¸€å€‹ç°¡åŒ–çš„ç¯„ä¾‹ï¼Œå¯¦éš›éœ€è¦æ›´å®Œæ•´çš„é‚è¼¯
        // M=é€±ä¸€, T=é€±äºŒ, W=é€±ä¸‰, R=é€±å››, F=é€±äº”, S=é€±å…­
        const mapping = { 'M': 1, 'T': 2, 'W': 3, 'R': 4, 'F': 5, 'S': 6, 'U': 7 };
        const slots = [];
        const regex = /([MTWRFSU])([1-9a-dn])/g;
        let match;
        while ((match = regex.exec(timeCode)) !== null) {
            slots.push({ day: mapping[match[1]], slot: match[2] });
        }
        return slots;
    },

    // TODO: è§£æé¸èª²çµæœé é¢çš„èª²è¡¨ (JH713005.html)
    parseSchedulePage(htmlContent) {
        // æ­¤å‡½æ•¸éœ€è¦èƒ½å¤ æ¥æ”¶ JH713005.html çš„å…§å®¹
        // ç„¶å¾Œè§£æå…¶ä¸­çš„èª²è¡¨ï¼Œè¿”å›ä¸€å€‹é¡ä¼¼ parseTimeCode çµæœçš„é™£åˆ—
        // é€™éƒ¨åˆ†éœ€è¦é€é background script æˆ–å…¶ä»–æ–¹å¼ç²å–é é¢å…§å®¹
        return [];
    }
};
scripts/modal.js
JavaScript

// scripts/modal.js
// è² è²¬å»ºç«‹èˆ‡ç®¡ç†äº’å‹•è¦–çª—

const NthuCourseModal = {
    show(url) {
        // ç§»é™¤èˆŠçš„ modal
        this.close();

        const modalOverlay = document.createElement('div');
        modalOverlay.id = 'nthu-helper-modal-overlay';

        const modalContent = document.createElement('div');
        modalContent.id = 'nthu-helper-modal-content';
        modalContent.innerHTML = `
            <button id="nthu-helper-modal-close">&times;</button>
            <iframe src="${url}"></iframe>
        `;

        modalOverlay.appendChild(modalContent);
        document.body.appendChild(modalOverlay);

        // ç¶å®šé—œé–‰äº‹ä»¶
        document.getElementById('nthu-helper-modal-close').addEventListener('click', this.close);
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                this.close();
            }
        });
    },

    close() {
        const modalOverlay = document.getElementById('nthu-helper-modal-overlay');
        if (modalOverlay) {
            modalOverlay.remove();
        }
    }
};
styles/style.css
CSS

/* styles/style.css */

/* --- ç¯©é¸å™¨é¢æ¿ --- */
.nthu-helper-container {
  background-color: #fff;
  border: 2px solid #658487;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 8px;
}
.nthu-helper-container h2, .nthu-helper-container h3 {
  color: #3d32a0;
  border-bottom: 1px solid #eee;
  padding-bottom: 5px;
}
.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  margin-bottom: 15px;
}
.filters input[type="text"] {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* --- æ™‚é–“é¸æ“‡æ ¼å­ --- */
.nthu-helper-time-grid {
  display: grid;
  grid-template-columns: 30px repeat(7, 1fr);
  gap: 2px;
}
.time-header div, .time-label {
  text-align: center;
  font-weight: bold;
}
.time-row {
  display: contents;
}
.time-slot {
  height: 25px;
  background-color: #f0f0f0;
  border: 1px solid #ddd;
  cursor: pointer;
  transition: background-color 0.2s;
}
.time-slot:hover {
  background-color: #e0e0e0;
}
.time-slot.selected {
  background-color: #3498db;
  border-color: #2980b9;
}

/* --- æŸ¥è©¢æŒ‰éˆ• --- */
.nthu-helper-search-btn {
  position: absolute;
  top: 2px;
  right: 2px;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 50%;
  cursor: pointer;
  font-size: 12px;
  width: 20px;
  height: 20px;
  line-height: 18px;
  text-align: center;
  opacity: 0.5;
  transition: opacity 0.2s;
}
td:hover .nthu-helper-search-btn {
  opacity: 1;
}

/* --- æŸ¥è©¢èœå–® --- */
#nthu-helper-search-menu {
  position: fixed;
  background: white;
  border: 1px solid #ccc;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  z-index: 9999;
  border-radius: 4px;
}
#nthu-helper-search-menu .menu-title {
  padding: 8px 12px;
  font-weight: bold;
  background-color: #f5f5f5;
}
#nthu-helper-search-menu ul {
  list-style: none;
  margin: 0;
  padding: 5px 0;
}
#nthu-helper-search-menu li {
  padding: 8px 15px;
  cursor: pointer;
}
#nthu-helper-search-menu li:hover {
  background-color: #3498db;
  color: white;
}

/* --- äº’å‹•è¦–çª— (Modal) --- */
#nthu-helper-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  display: flex;
  justify-content: center;
  align-items: center;
}
#nthu-helper-modal-content {
  background: #fff;
  width: 80%;
  height: 80%;
  border-radius: 8px;
  position: relative;
  display: flex;
  flex-direction: column;
}
#nthu-helper-modal-close {
  position: absolute;
  top: -15px;
  right: -15px;
  background: white;
  border: 2px solid black;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 20px;
  cursor: pointer;
}
#nthu-helper-modal-content iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 8px;
}